<div class="management-container">
  <div *ngIf="isOpen" class="form-container">
    <form #productForm="ngForm" (ngSubmit)="submitForm(productForm)">
      <ul class="form">
        <li>
          <h2>{{ _id ? "Edit Product" : "Create Product" }}</h2>
          <button class="close-modal-btn" (click)="closeModal()">
            <fa-icon [icon]="faTimes"></fa-icon>
          </button>
        </li>
        <li>
          <div *ngIf="loading$ | async as loading" class="form-msg-loading">
            Loading...
          </div>
          <div *ngIf="error$ | async as error" class="form-msg-error">
            {{ error }}
          </div>
          <div *ngIf="saveMsg$ | async as saveMsg" class="form-msg-success">
            {{ saveMsg }}
          </div>
        </li>
        <li>
          <input
            type="text"
            name="name"
            id="name"
            [class.has-error]="nameControl.invalid && nameControl.touched"
            [class.has-success]="nameControl.valid && nameControl.touched"
            placeholder="Name"
            [(ngModel)]="name"
            required
            #nameControl="ngModel"
          />
          <span
            class="input-error-msg"
            *ngIf="nameControl.invalid && nameControl.touched"
            >Item name is required</span
          >
        </li>
        <li>
          <input
            type="text"
            name="brand"
            id="brand"
            [class.has-error]="brandControl.invalid && brandControl.touched"
            [class.has-success]="brandControl.valid && brandControl.touched"
            placeholder="Brand"
            [(ngModel)]="brand"
            required
            #brandControl="ngModel"
          />
          <span
            class="input-error-msg"
            *ngIf="brandControl.invalid && brandControl.touched"
            >Item brand is required</span
          >
        </li>
        <li>
          <input
            type="text"
            name="colour"
            id="colour"
            [class.has-error]="colourControl.invalid && colourControl.touched"
            [class.has-success]="colourControl.valid && colourControl.touched"
            placeholder="Colour"
            [(ngModel)]="colour"
            required
            #colourControl="ngModel"
          />
          <span
            class="input-error-msg"
            *ngIf="colourControl.invalid && colourControl.touched"
            >Item colour is required</span
          >
        </li>
        <li>
          <input
            type="text"
            name="price"
            id="price"
            [class.has-error]="priceControl.invalid && priceControl.touched"
            [class.has-success]="priceControl.valid && priceControl.touched"
            placeholder="Price"
            [(ngModel)]="price"
            required
            #priceControl="ngModel"
          />
          <span
            class="input-error-msg"
            *ngIf="priceControl.invalid && priceControl.touched"
            >Item price is required</span
          >
        </li>
        <li>
          <input
            type="text"
            name="img"
            id="img"
            [class.has-error]="imgControl.invalid && imgControl.touched"
            [class.has-success]="imgControl.valid && imgControl.touched"
            placeholder="Image URL"
            [(ngModel)]="img"
            required
            #imgControl="ngModel"
          />
          <span
            class="input-error-msg"
            *ngIf="imgControl.invalid && imgControl.touched"
            >Image URL is required</span
          >
        </li>
        <li>
          <input
            type="text"
            name="category"
            id="category"
            [class.has-error]="
              categoryControl.invalid && categoryControl.touched
            "
            [class.has-success]="
              categoryControl.valid && categoryControl.touched
            "
            placeholder="Category"
            [(ngModel)]="category"
            #categoryControl="ngModel"
          />
          <span
            class="input-error-msg"
            *ngIf="categoryControl.invalid && categoryControl.touched"
            >Category is required</span
          >
        </li>
        <li>
          <input
            type="text"
            name="description"
            id="description"
            [class.has-error]="
              descriptionControl.invalid && descriptionControl.touched
            "
            [class.has-success]="
              descriptionControl.valid && descriptionControl.touched
            "
            placeholder="Description"
            [(ngModel)]="description"
            required
            #descriptionControl="ngModel"
          />
          <span
            class="input-error-msg"
            *ngIf="descriptionControl.invalid && descriptionControl.touched"
            >Item description is required</span
          >
        </li>
        <li>
          <input
            type="text"
            name="countInStock"
            id="countInStock"
            [class.has-error]="
              countInStockControl.invalid && countInStockControl.touched
            "
            [class.has-success]="
              countInStockControl.valid && countInStockControl.touched
            "
            placeholder="Number of item in stock"
            [(ngModel)]="countInStock"
            required
            #countInStockControl="ngModel"
          />
          <span
            class="input-error-msg"
            *ngIf="countInStockControl.invalid && countInStockControl.touched"
            >Number of item in stock is required</span
          >
        </li>
        <li>
          <button
            [disabled]="productForm.invalid"
            type="submit"
            class="submit-form-btn"
          >
            {{ _id ? "Update" : "Create" }}
          </button>
          <button class="cancel-modal-btn" (click)="closeModal()">
            Cancel
          </button>
        </li>
      </ul>
    </form>
  </div>
  <div *ngIf="!isOpen">
    <h2>Product Manager</h2>
    <button (click)="openModal()" class="open-product-modal">
      Create Product
    </button>
    <table class="products-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Price (â‚¬)</th>
          <th>Category</th>
          <th>Brand</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody *ngIf="products$ | async as products">
        <tr *ngFor="let product of products">
          <td>{{ product._id }}</td>
          <td>{{ product.name }}</td>
          <td>{{ product.price }}</td>
          <td>{{ product.category }}</td>
          <td>{{ product.brand }}</td>
          <td>
            <button class="edit-btn" (click)="openModal(product)">Edit</button>
            <button (click)="deleteProduct(product._id)">Delete</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
